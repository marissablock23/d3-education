)
labor %>%
group_by(country) %>%
mutate(intGrowth = (intermediate - lag(intermediate))/lag(intermediate)) %>%
full_join(growth) %>%
filter(country=="Chile" & Sex=="Total" & Age=="15+") %>%
ggplot(aes(x = secGrowth, y = intGrowth, label = year)) +
geom_point() +
geom_label(aes(label = year)) +
geom_segment(aes(xend = c(tail(secGrowth, n = -1), NA),
yend=c(tail(intGrowth, n = -1), NA)),
arrow = arrow(length=unit(0.3, "cm")))
labor %>%
group_by(country) %>%
mutate(intGrowth = (intermediate - lag(intermediate))/lag(intermediate)) %>%
full_join(growth) %>%
filter(country=="Ghana" & Sex=="Total" & Age=="15+") %>%
ggplot(aes(x = secGrowth, y = intGrowth, label = year)) +
geom_point() +
geom_label(aes(label = year)) +
geom_segment(aes(xend = c(tail(secGrowth, n = -1), NA),
yend=c(tail(intGrowth, n = -1), NA)),
arrow = arrow(length=unit(0.3, "cm")))
library(tidyverse)
library(readxl)
library(here)
library(jsonlite)
returns <- read_xlsx("data/ReturnsEdAnnex2.xlsx", sheet = "Sheet 1",
na = "", skip = 7)
# Rename variables
returns <- returns %>%
rename("country" = "..1", "year"= "..2", "Region" = "..3", "inc" = "..4", "yrs.sch" = "..5", "overall" = "..6", "primary" = "Prim..7", "secondary" = "Sec..8", "higher" = "Higher..9", "primary.soc" = "Prim..13", "secondary.soc" = "Sec..14", "higher.soc" = "Higher..15", "male" = "Males", "female" = "Females", "private" = "Private", "public" = "Public", "source" = "See Annex 3")
# Ignore full discounting, private for now
# Remove first row
returns <- returns[-1,]
knitr::opts_chunk$set(echo = TRUE)
returns.ovr <- returns %>%
group_by(country) %>%
filter(!is.na(overall)) %>%
filter(year == max(year)) %>%
rename(year.return = "year")
returns.ovr
returns.ovr <- returns %>%
group_by(country) %>%
filter(!is.na(overall)) %>%
filter(year == max(year)) %>%
rename(year.return = "year") %>%
select(country, year.return, overall)
returns.ovr
# First, filter to get overall returns for most recent year in which data is available
returns.ovr <- returns %>%
group_by(country) %>%
#filter(!is.na(overall)) %>%
filter(year == max(year)) %>%
rename(year.return = "year") %>%
select(country, year.return, overall)
reutnrs.ovr
returns.ovr
returns.ovr <- returns %>%
group_by(country) %>%
filter(!is.na(overall)) %>%
filter(year == max(year)) %>%
rename(year.return = "year")
returns.ovr
returns.prim <- returns %>%
group_by(country) %>%
filter(!is.na(primary)) %>%
filter(year == max(year)) %>%
rename(year.return = "year") %>%
select(country, year.return, primary)
returns.ovr
returns.prim
returns.ovr <- returns %>%
group_by(country) %>%
filter(!is.na(overall)) %>%
filter(year == max(year)) %>%
rename(year.return = "year") %>%
select(country, year.return, overall)
returns.ovr
merge <- returns.ovr %>%
full_join(returns.prim)
merge
merge <- returns.ovr %>%
full_join(returns.prim) %>%
gather("overall", "primary", key = "type", value = "value")
merge
tail(merge)
remove returns.ovr
remove(returns.ovr)
remove(returns.prim)
type <- c("overall", "primary")
for (val in type) {
returns.val <- returns %>%
group_by(country) %>%
filter(!is.na(val)) %>%
filter(year == max(year)) %>%
rename(year.return = "year") %>%
select(country.year.return, val)
}
remove(type)
remove(val)
type <- c("overall", "primary")
for (val in type) {
returns.val <- returns %>%
group_by(country) %>%
filter(!is.na(val)) %>%
filter(year == max(year)) %>%
rename(year.return = "year") %>%
select(country, year.return, val)
}
remove(val)
remove(type)
returns.ovr <- returns %>%
group_by(country) %>%
filter(!is.na(overall)) %>%
filter(year == max(year)) %>%
rename(year.return = "year") %>%
select(country, year.return, overall)
returns.prim <- returns %>%
group_by(country) %>%
filter(!is.na(primary)) %>%
filter(year == max(year)) %>%
rename(year.return = "year") %>%
select(country, year.return, primary)
returns.sec <- returns %>%
group_by(country) %>%
filter(!is.na(secondary)) %>%
filter(year === max(year)) %>%
returns.sec <- returns %>%
group_by(country) %>%
filter(!is.na(secondary)) %>%
filter(year == max(year)) %>%
rename(year.return = "year") %>%
select(country, year.return, secondary)
merge <- returns.ovr %>%
full_join(returns.prim) %>%
full_join(returns.sec) %>%
gather("overall", "primary", "secondary", key = "type", value = "value")
merge
merge <- returns.ovr %>%
full_join(returns.prim) %>%
full_join(returns.sec) %>%
gather("overall", "primary", "secondary", key = "type", value = "value") %>%
order(country, year.return)
merge <- merge[order(country, year.return),]
help sort
?sort
merge
merge <- returns.ovr %>%
full_join(returns.prim) %>%
full_join(returns.sec) %>%
gather("overall", "primary", "secondary", key = "type", value = "value") %>%
write_csv(returns2, path = "data/clean/returns2.csv")
merge <- returns.ovr %>%
full_join(returns.prim) %>%
full_join(returns.sec) %>%
gather("overall", "primary", "secondary", key = "type", value = "value") %>%
write_csv(path = "data/clean/returns2.csv")
merge <- returns.ovr %>%
full_join(returns.prim) %>%
full_join(returns.sec) %>%
gather("overall", "primary", "secondary", key = "type", value = "value") %>%
rename(year = "year.return") %>%
write_csv(path = "data/clean/returns2.csv")
library(tidyverse)
library(readxl)
library(here)
library(jsonlite)
returns <- read_xlsx("data/ReturnsEdAnnex2.xlsx", sheet = "Sheet 1",
na = "", skip = 7)
# Rename variables
returns <- returns %>%
rename("country" = "..1", "year"= "..2", "Region" = "..3", "inc" = "..4", "yrs.sch" = "..5", "overall" = "..6", "primary" = "Prim..7", "secondary" = "Sec..8", "higher" = "Higher..9", "primary.soc" = "Prim..13", "secondary.soc" = "Sec..14", "higher.soc" = "Higher..15", "male" = "Males", "female" = "Females", "private" = "Private", "public" = "Public", "source" = "See Annex 3")
# Ignore full discounting, private for now
# Remove first row
returns <- returns[-1,]
knitr::opts_chunk$set(echo = TRUE)
returns.ovr <- returns %>%
group_by(country) %>%
filter(!is.na(overall)) %>%
filter(year == max(year)) %>%
rename(year.return = "year") %>%
select(country, year.return, overall)
returns.ovr
merge <- returns.ovr %>%
full_join(returns.prim) %>%
full_join(returns.sec) %>%
gather("overall", "primary", "secondary", key = "type", value = "value") %>%
rename(year = "year.return")
returns.prim <- returns %>%
group_by(country) %>%
filter(!is.na(primary)) %>%
filter(year == max(year)) %>%
rename(year.return = "year") %>%
select(country, year.return, primary)
returns.sec <- returns %>%
group_by(country) %>%
filter(!is.na(secondary)) %>%
filter(year == max(year)) %>%
rename(year.return = "year") %>%
select(country, year.return, secondary)
merge <- returns.ovr %>%
full_join(returns.prim) %>%
full_join(returns.sec) %>%
gather("overall", "primary", "secondary", key = "type", value = "value") %>%
rename(year = "year.return")
merge
merge <- returns.ovr %>%
full_join(returns.prim) %>%
full_join(returns.sec) %>%
gather("overall", "primary", "secondary", key = "type", value = "value") %>%
rename(year = "year.return") %>%
arrange(country, year)
merge
returns.prim <- returns %>%
group_by(country) %>%
filter(!is.na(primary)) %>%
filter(year == max(year)) %>%
rename(year.return = "year") %>%
select(country, year.return, primary, source)
returns.sec <- returns %>%
group_by(country) %>%
filter(!is.na(secondary)) %>%
filter(year == max(year)) %>%
rename(year.return = "year") %>%
select(country, year.return, secondary, source)
returns.high <- returns %>%
group_by(country) %>%
filter(!is.na(higher)) %>%
filter(year == max(year)) %>%
rename(year.return = "year") %>%
select(country, year.return, higher, source)
returns.male <- returns %>%
group_by(country) %>%
filter(!is.na(male)) %>%
filter(year == max(year)) %>%
rename(year.return = "year") %>%
select(country, year.return, male, source)
returns.female <- returns %>%
group_by(country) %>%
filter(!is.na(female)) %>%
filter(year == max(year)) %>%
rename(year.return = "year") %>%
select(country, year.return, female, source)
merge <- returns.ovr %>%
full_join(returns.prim) %>%
full_join(returns.sec)
merge
merge(n=10)
head(merge, n = 10)
head(merge, n = 20)
merge <- returns.ovr %>%
full_join(returns.prim) %>%
full_join(returns.sec) %>%
gather("overall", "primary", "secondary", key = "type", value = "value") %>%
rename(year = "year.return")
merge
merge <- returns.ovr %>%
full_join(returns.prim) %>%
full_join(returns.sec)
merge
returns.ovr <- returns %>%
group_by(country) %>%
filter(!is.na(overall)) %>%
filter(year == max(year)) %>%
rename(year.return = "year", source.ovr = "source") %>%
select(country, year.return, overall, source)
returns.ovr <- returns %>%
group_by(country) %>%
filter(!is.na(overall)) %>%
filter(year == max(year)) %>%
rename(year.return = "year", source.ovr = "source") %>%
select(country, year.return, overall, source.ovr)
returns.prim <- returns %>%
group_by(country) %>%
filter(!is.na(primary)) %>%
filter(year == max(year)) %>%
rename(year.return = "year", source.prim = "source") %>%
select(country, year.return, primary, source.prim)
returns.sec <- returns %>%
group_by(country) %>%
filter(!is.na(secondary)) %>%
filter(year == max(year)) %>%
rename(year.return = "year", source.sec = "source") %>%
select(country, year.return, secondary, source.sec)
merge <- returns.ovr %>%
full_join(returns.prim) %>%
full_join(returns.sec)
merge
merge <- returns.ovr %>%
full_join(returns.prim) %>%
full_join(returns.sec) %>%
gather("overall", "primary", "secondary", key = "type", value = "value")
merge
merge <- returns.ovr %>%
full_join(returns.prim) %>%
full_join(returns.sec) %>%
gather("overall", "primary", "secondary", key = "type", value = "value") %>%
gather("source.ovr", "source.prim", "source.sec", key = "source.type", value = "source") %>%
rename(year = "year.return") %>%
arrange(country, year)
merge
merge <- returns.ovr %>%
full_join(returns.prim) %>%
full_join(returns.sec) %>%
gather("overall", "primary", "secondary", key = "type", value = "value") %>%
gather("source.ovr", "source.prim", "source.sec", key = "source.type", value = "source") %>%
rename(year = "year.return") %>%
arrange(country, year) %>%
filter(!is.na(value))
merge
merge <- returns.ovr %>%
full_join(returns.prim) %>%
full_join(returns.sec) %>%
gather("overall", "primary", "secondary", key = "type", value = "value") %>%
gather("source.ovr", "source.prim", "source.sec", key = "source.type", value = "source") %>%
rename(year = "year.return") %>%
arrange(country, year) %>%
filter(!is.na(value)) %>%
filer(!is.na(source))
merge <- returns.ovr %>%
full_join(returns.prim) %>%
full_join(returns.sec) %>%
gather("overall", "primary", "secondary", key = "type", value = "value") %>%
gather("source.ovr", "source.prim", "source.sec", key = "source.type", value = "source") %>%
rename(year = "year.return") %>%
arrange(country, year) %>%
filter(!is.na(value)) %>%
filter(!is.na(source))
merge
merge <- returns.ovr %>%
full_join(returns.prim) %>%
full_join(returns.sec) %>%
gather("overall", "primary", "secondary", key = "type", value = "value") %>%
gather("source.ovr", "source.prim", "source.sec", key = "source.type", value = "source") %>%
rename(year = "year.return") %>%
arrange(country, year)
merge
merge <- returns.ovr %>%
full_join(returns.prim) %>%
full_join(returns.sec) %>%
gather("overall", "primary", "secondary", key = "type", value = "value") %>%
gather("source.ovr", "source.prim", "source.sec", key = "source.type", value = "source") %>%
rename(year = "year.return") %>%
arrange(country, year) %>%
filter(!is.na(value)) %>%
filter(!is.na(source)) %>%
unique()
merge
merge <- returns.ovr %>%
full_join(returns.prim) %>%
full_join(returns.sec) %>%
gather("overall", "primary", "secondary", key = "type", value = "value") %>%
gather("source.ovr", "source.prim", "source.sec", key = "source.type", value = "source") %>%
rename(year = "year.return") %>%
arrange(country, year) %>%
filter(!is.na(value)) %>%
filter(!is.na(source)) %>%
select(-source.type) %>%
unique()
merge
returns.ovr <- returns %>%
group_by(country) %>%
filter(!is.na(overall)) %>%
filter(year == max(year)) %>%
rename(year.return = "year", source.ovr = "source") %>%
select(country, year.return, overall, source.ovr)
returns.prim <- returns %>%
group_by(country) %>%
filter(!is.na(primary)) %>%
filter(year == max(year)) %>%
rename(year.return = "year", source.prim = "source") %>%
select(country, year.return, primary, source.prim)
returns.sec <- returns %>%
group_by(country) %>%
filter(!is.na(secondary)) %>%
filter(year == max(year)) %>%
rename(year.return = "year", source.sec = "source") %>%
select(country, year.return, secondary, source.sec)
returns.high <- returns %>%
group_by(country) %>%
filter(!is.na(higher)) %>%
filter(year == max(year)) %>%
rename(year.return = "year", source.high = "source") %>%
select(country, year.return, higher, source.high)
returns.male <- returns %>%
group_by(country) %>%
filter(!is.na(male)) %>%
filter(year == max(year)) %>%
rename(year.return = "year", source.male = "source") %>%
select(country, year.return, male, source.male)
returns.female <- returns %>%
group_by(country) %>%
filter(!is.na(female)) %>%
filter(year == max(year)) %>%
rename(year.return = "year", source.female = "source") %>%
select(country, year.return, female, source.female)
merge <- returns.ovr %>%
full_join(returns.prim) %>%
full_join(returns.sec) %>%
ful_join(returns.high) %>%
full_join(returns.male) %>%
full_join(returns.female) %>%
gather("overall", "primary", "secondary", key = "type", value = "value") %>%
gather("source.ovr", "source.prim", "source.sec", key = "source.type", value = "source") %>%
rename(year = "year.return") %>%
arrange(country, year) %>%
filter(!is.na(value)) %>%
filter(!is.na(source)) %>%
select(-source.type) %>%
unique() %>%
write_csv(path = "data/clean/returns2.csv")
returns.ovr <- returns %>%
group_by(country) %>%
filter(!is.na(overall)) %>%
filter(year == max(year)) %>%
rename(year.return = "year", source.ovr = "source") %>%
select(country, year.return, overall, source.ovr)
returns.prim <- returns %>%
group_by(country) %>%
filter(!is.na(primary)) %>%
filter(year == max(year)) %>%
rename(year.return = "year", source.prim = "source") %>%
select(country, year.return, primary, source.prim)
returns.sec <- returns %>%
group_by(country) %>%
filter(!is.na(secondary)) %>%
filter(year == max(year)) %>%
rename(year.return = "year", source.sec = "source") %>%
select(country, year.return, secondary, source.sec)
returns.high <- returns %>%
group_by(country) %>%
filter(!is.na(higher)) %>%
filter(year == max(year)) %>%
rename(year.return = "year", source.high = "source") %>%
select(country, year.return, higher, source.high)
returns.male <- returns %>%
group_by(country) %>%
filter(!is.na(male)) %>%
filter(year == max(year)) %>%
rename(year.return = "year", source.male = "source") %>%
select(country, year.return, male, source.male)
returns.female <- returns %>%
group_by(country) %>%
filter(!is.na(female)) %>%
filter(year == max(year)) %>%
rename(year.return = "year", source.female = "source") %>%
select(country, year.return, female, source.female)
merge <- returns.ovr %>%
full_join(returns.prim) %>%
full_join(returns.sec) %>%
full_join(returns.high) %>%
full_join(returns.male) %>%
full_join(returns.female) %>%
gather("overall", "primary", "secondary", key = "type", value = "value") %>%
gather("source.ovr", "source.prim", "source.sec", key = "source.type", value = "source") %>%
rename(year = "year.return") %>%
arrange(country, year) %>%
filter(!is.na(value)) %>%
filter(!is.na(source)) %>%
select(-source.type) %>%
unique() %>%
write_csv(path = "data/clean/returns2.csv")
merge
merge <- returns.ovr %>%
full_join(returns.prim) %>%
full_join(returns.sec) %>%
full_join(returns.high) %>%
full_join(returns.male) %>%
full_join(returns.female) %>%
gather("overall", "primary", "secondary", key = "type", value = "value") %>%
gather("source.ovr", "source.prim", "source.sec", "source.high", "source.male", "source.female", key = "source.type", value = "source") %>%
rename(year = "year.return") %>%
arrange(country, year) %>%
filter(!is.na(value)) %>%
filter(!is.na(source)) %>%
select(-source.type) %>%
unique() %>%
write_csv(path = "data/clean/returns2.csv")
merge
merge <- returns.ovr %>%
full_join(returns.prim) %>%
full_join(returns.sec) %>%
full_join(returns.high) %>%
full_join(returns.male) %>%
full_join(returns.female) %>%
gather("overall", "primary", "secondary", "higher", "male", "female", key = "type", value = "value") %>%
gather("source.ovr", "source.prim", "source.sec", "source.high", "source.male", "source.female", key = "source.type", value = "source") %>%
rename(year = "year.return") %>%
arrange(country, year) %>%
filter(!is.na(value)) %>%
filter(!is.na(source)) %>%
select(-source.type) %>%
unique() %>%
write_csv(path = "data/clean/returns2.csv")
merge
merge <- returns.ovr %>%
full_join(returns.prim) %>%
full_join(returns.sec) %>%
full_join(returns.high) %>%
full_join(returns.male) %>%
full_join(returns.female) %>%
gather("overall", "primary", "secondary", "higher", "male", "female", key = "type", value = "value") %>%
gather("source.ovr", "source.prim", "source.sec", "source.high", "source.male", "source.female", key = "source.type", value = "source") %>%
rename(year = "year.return") %>%
arrange(country, year) %>%
filter(!is.na(value)) %>%
filter(!is.na(source)) %>%
select(-source.type) %>%
unique()
head(merge, n = 40)
View(merge)
